<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Java - Pass by Value or Pass by Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../src/boostrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../src/global/global.css" rel="stylesheet">

    <script type="text/javascript" src="../src/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="../src/boostrap/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="../src/global/global.js"></script>
</head>

<body class="bg-secondary">
<nav class="navbar navbar-expand-md navbar-dark bg-dark mb-4">
    <a class="navbar-brand" href="#">Top navbar</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Disabled</a>
            </li>
        </ul>
        <form class="form-inline mt-2 mt-md-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>

<main role="main" class="container">
    <div class="introduction">
        <h1>Java - Pass by Value or Pass by Reference</h1>
        <div class="lead">
            <p>Đây luôn là 1 vấn đề đau đầu khi code với Java. Ngày xưa cũng rớt phỏng vấn vì 1 câu hỏi như thế này.</p>

            <p>Xin khẳng định luôn, <strong style="text-transform: uppercase">Java luôn truyền tham trị.</strong></p>

            <p>Xem ví dụ <strong>ObjectReference</strong> trong source code để biết thêm thông tin chi tiết</p>
        </div>
    </div>

    <div class="my-4 p-3 bg-white rounded box-shadow">
        <h3 class="border-bottom border-gray pb-2 mb-0">Ví dụ 1: swap 2 object</h3>
        <div class="text-dark pt-3">
            <h3>Open file này lên <strong>ObjectReference</strong>. và chạy function <strong>swapTwoObjectAndShowResult</strong> để kiểm tra kết quả.</h3>

            <p>Cái hàm swap thì ai cũng biết rồi</p>

            <blockquote>
                function swapTwoObject (objectA, object B) { <br/>
                &nbsp;&nbsp;&nbsp;&nbsp;objectC = objectB; <br/>
                &nbsp;&nbsp;&nbsp;&nbsp;objectB = objectA; <br/>
                &nbsp;&nbsp;&nbsp;&nbsp;objectA = objectC; <br/>
                }
            </blockquote>

            <p>Đáng lẽ thì 2 object đó phải đổi giá trị cho nhau, như cái redColor và greenColor trong ví dụ kia rồi. Nhưng
                mà sao nó vẫn như cũ @@.</p>

            <p>Thế nhưng tại sao mà sau khi in két quả ra chả thay đổi cái khỉ gì???</p>

            <h4>Java vẫn truyền đi tham trị, tuy nhiên giá trị của nó lại hơi đặc biệt 1 tí.</h4>

            <p>Để giải thích rõ hơn về cái này, cùng xem lại cách mà 1 object Java được khởi tạo như thế nào ở các bài trước
                nhé.</p>

            <ul>
                <li>Java (Java Vitual Machine) sẽ lấy ra 1 địa chỉ bộ nhớ còn trống trong memory để lưu dữ liệu của object
                </li>
                <li>Các biến trong đối tượng mới này được gọi là instance variable / field được gán cho các giá trị mặc định
                    nếu nó được khai báo mà chưa gán giá trị
                </li>

                <li>Sau đó Java sẽ gọi constructor method với các đối số được sử dụng khi tạo object</li>

                <li>Cuối cùng, JVM sẽ trả về <b style="text-transform: uppercase">địa chỉ bộ nhớ trên ram</b></li>

                <li>Nếu như một biến được gán giá trị từ việc khởi tạo object, thì Java sẽ gán giá trị của bộ nhớ này cho
                    giá trị của biến đó.
                </li>

                <li><span>OBJECT_REFERENCE_ADDRESS_VALUE</span> -------------------------------> <span>OBJECT_DATA</span>
                </li>
            </ul>

            <p>Giải thích như thế này cho dễ hiểu hơn nè.</p>

            <ul>
                <li>Khi khởi tạo đối tượng, biến redColor sẽ chứa địa chỉ vùng nhớ của đối tượng Color</li>
                <li>Đối tượng Color được lưu ở heap</li>
                <li>Biến redColor được lưu ở stack</li>
                <li>Khi gọi function swapColor, đầu tiên JVM sẽ sao chép giá trị của biến redColor sang một biến mới : cloneRedColor</li>
                <li>Biến cloneRedColor và redColor này đều có giá trị chỉ đến vùng nhớ của đối tượng Color mà ta vừa tạo.</li>
                <li>Sau đó, nó truyền biến cloneRedColor này vào function.</li>
            </ul>

            <p>
                Tóm lại. ta cần ghi nhớ, khi khởi tạo đối tượng Color, biến redColor sẽ chứa địa chỉ của vùng nhớ đối tượng
                Color. Đối tượng Color được lưu ở heap, và giá trị biến redColor đượclưu ở stack.
            </p>

            <p>Ta để ý cái dòng cuối cùng ở trên kia, khi gọi method swapTwoNumber, JAVA không truyền 2 object redColor
                và greenColor vào trong function, thay vào đó nó clone ra 2 biến mới và gán cái OBJECT_REFERENCE_ADDRESS_VALUE
                tới cái OBJECT_DATA của cái kia.</p>
            <p>
                Vì vậy, việc swap các giá trị ở trong function đó, là đang làm việc với clone object chứ không phải làm việc
                với object redColor hay greenColor ở ban đầu.
            </p>

            <p>Sau function, biến copy đó được giải phóng, và vì thằng redColor, greenColor có đc update gì đâu, nên nó vẫn vậy</p>

            <p>Xem minh họa về cái function kia hoạt động ntn nhé.</p>

            <img src="../assests/example_bind_variable_in_java.png" width="1486" height="850" class="img-fluid"/>

            <p>Ta luôn nhớ, thứ mà ta làm việc (variable) chỉ là cái địa chỉ của object đó trên bộ nhớ. Và cái địa chỉ mà nó
                chỉ tới kia mới thực sự là giá trị của object (attribute đc lưu ở đây).</p>

            <p>Vì vậy, trong cái hàm swap kia, thứ nó truyền vào là 2 variable clone từ 2 cái object hiện tại. Do đó, thao tác
                gán địa chỉ (swap by assign) kia nó chỉ ảnh hưởng tới địa chỉ của clone, chứ ko ảnh hưởng đến địa chỉ thực.</p>
        </div>
    </div>

    <div class="my-4 p-3 bg-white rounded box-shadow">
        <h3 class="border-bottom border-gray pb-2 mb-0">Ví dụ 2: swap 2 object by change attribute</h3>
        <div class="text-dark pt-3">
            <p>Cũng trong file đó, giờ ta chạy function <strong>swapTwoColorAndShowResult</strong></p>

            <p>Ở đây, ta viết lại function swapTwoObject như sau</p>

            <blockquote>
                function swapTwoObject (objectA, object B) { <br/>
                &nbsp;&nbsp;&nbsp;&nbsp;String temp = objectB.getColor();<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;objectB.setColor(objectA.getColor());<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;objectA.setColor(temp);<br/>
                }
            </blockquote>

            <p>Khác với function trước, ở đây ta tiến hành set lại giá trị color của 2 object truyền vào. Và sau khi show
                kết quả, 2 object đã đc swap 2 color khác nhau. Ta giải thích điều này như thế nào ???</p>

            <p>Trong function, mặc dù các biến ta truyền vào chỉ là biến clone địa chỉ của redColor và greenColor.
                Tuy nhiên, việc gọi function setColor - đã làm thay đổi giá trị của đối tượng color trong vùng nhớ đc tham
                chiếu tới củathực thể này</p>

            <p>Vì vậy mặc dù chỉ là truyền 1 biến clone vào, nhưng kết quả lại khiến vùng nhớ mà 2 biến redColor và greenColor chỉ tới
                bị thay đổi, nên sau khi thực thi xong, thì giá trị của 2 object chính cũng bị update 1 cách gián tiếp. Xem minh họa:</p>

            <img src="../assests/example_bind_variable_in_java_02.png" width="1382" height="750" class="img-fluid"/>


            <p>Mọi thứ ban đầu như ví dụ 1</p>
            <ul>
                <li>Khi khởi tạo đối tượng, biến redColor sẽ chứa địa chỉ vùng nhớ của đối tượng Color</li>
                <li>Đối tượng Color được lưu ở heap</li>
                <li>Biến redColor được lưu ở stack</li>
                <li>Khi gọi function swapColor, đầu tiên JVM sẽ sao chép giá trị của biến redColor sang một biến mới : cloneRedColor</li>
                <li>Biến cloneRedColor và redColor này đều có giá trị chỉ đến vùng nhớ của đối tượng Color mà ta vừa tạo.</li>
                <li>Sau đó, nó truyền biến cloneRedColor này vào function.</li>
            </ul>
            <p>Chỉ khác:</p>

            <ul>
                <li>
                    Trong function swapTwoObject by change color kia, khi ta gọi hàm setColor trên biến redColorCopy kia,
                    câu lệnh này làm thay đổi thuộc tính color của đối tượng mà biến redColor copy kia đang trỏ tới.
                </li>

                <li>Sau khi ra khỏi hàm, biến redColorCopy kia ko tồn tại nữa, nhưng sự thay đổi vùng nhớ mà nó trỏ đến vẫn giữ
                    nguyên.</li>
            </ul>
        </div>
    </div>

    <div class="my-4 p-3 bg-white rounded box-shadow">
        <h3 class="border-bottom border-gray pb-2 mb-0">Ví dụ 3: swap 2 object by change attribute</h3>
        <div class="text-dark pt-3">
            <p>Tương tự ví dụ 2, giờ ta thêm thuộc tính subColor cho object Color, và các getter setter tương ứng</p>

            <p>Sau đó ta sửa lại hàm swapTwoObject lại như sau:</p>

            <blockquote>
                function swapTwoObject (Color objectA, Color objectB) { <br/>
                &nbsp;&nbsp;&nbsp;&nbsp;Color subColorTem = objectB.getSubColor();<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;objectB.setSubColor(objectA.getSubColor());<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;objectA.setSubColor(subColorTem);<br/>
                }
            </blockquote>

            <p>
                Và giờ, kết quả khi in ra thì 2 Object đã đc swap color giống ví dụ 2 rồi.
            </p>
        </div>
    </div>

    <div class="my-4 p-3 bg-white rounded box-shadow">
        <h3 class="border-bottom border-gray pb-2 mb-0">Tóm lại:</h3>
        <div class="text-dark pt-3">
            <ul>
                <li>Java pass by value</li>
                <li>Biến trong java không chứa giá trị, mà nó chứa địa chỉ của vùng nhớ chứa giá trị của object</li>
                <li>Khi clone object làm thay đổi giá trị vùng nhớ mà nó trỏ tới, thì cũng ảnh hưởng trực tiếp đến object
                    mà nó tham chiếu tới.</li>
                <li>Lưu ý điều này để viết code cho chính xác.</li>
            </ul>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <a class="btn btn-default float-lg-left" href="lesson_01_b_Java_Vitual_Machine.html">
                    Java Vitual Machine
                </a>

                <a class="btn btn-default float-lg-right" href="../javabasic/lesson_04_Object_n_Class_in_Java.html">
                    Java basic Lesson 1
                </a>
            </div>
        </div>
    </div>

    <br class="clearfix"/>

    <div class="container">
        <span class="text-dark">
            <address>
            Created by <strong>Khanh Tran</strong><br>
            Email: quockhanhqb011@gmail.com<br>
            Phone: (+84) 989 890 960
        </address>
        </span>
    </div>
</footer>
</body>
</html>